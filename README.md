# Average-watcher

**Average-watcher** — простой Telegram-бот на Go для мониторинга доступности серверов и устройств по IP-адресу. При изменении состояния бот отправляет уведомление в чат.

## Пример использования

Подняли хоумлаб или небольшой сервер? Нужно понимать, какие хосты сейчас онлайн и вовремя узнавать о падениях? Бот регулярно проверяет указанные IP и сообщает, если что-то изменилось.

## Функциональность

Доступные команды:

* `/add <ipv4>` — начать отслеживание IP-адреса
* `/remove <ipv4>` — прекратить отслеживание
* `/list` — список всех отслеживаемых IP
* `/status` — текущий статус всех хостов

## Запуск

### Вариант 1: Docker

1. Клонируйте репозиторий:

   ```bash
   git clone https://github.com/BetterLuckNextLife/average-watcher-bot/
   ```

2. Настройте конфигурацию:

   * отредактируйте `storage/watchers.json` и `storage/watchlist.json`
   * в `watchers.json` укажите ID чатов, куда бот будет отправлять уведомления
   * добавьте токен Telegram-бота в файл [.env](/.env)

3. Соберите Docker-образ:

   ```bash
   docker build -t average-watcher-bot .
   ```

4. Запустите контейнер:

   ```bash
   docker run -d --restart always --name average-watcher-bot average-watcher-bot:latest
   ```

### Вариант 2: Сборка бинарника

1. Клонируйте репозиторий:

   ```bash
   git clone https://github.com/BetterLuckNextLife/average-watcher-bot/
   ```

2. Настройте конфигурацию:

   * `storage/watchers.json`
   * `storage/watchlist.json`
   * файл [.env](/.env) с токеном бота

3. Соберите проект:

   ```bash
   go mod download
   go build main.go
   ```

4. Запустите:

   ```bash
   ./main
   ```

## Тестирование конфигурации

В репозитории есть готовая среда для локального тестирования с помощью `docker-compose`.

Команда запуска:

```bash
docker-compose up
```

Виртуальная сеть состоит из пяти контейнеров: один бот и четыре тестовых хоста, которые поочерёдно становятся недоступными. Это позволяет проверить работу уведомлений до запуска в основной сети.

Схема сети описана в файле `docker-compose.yaml`.

## Структура проекта

```
.
├── chat/                # Обработчики команд Telegram
├── checker/             # Логика проверки доступности хостов
├── config/              # Загрузка и работа с конфигурацией
├── data/                # Хранение IP, чатов и статусов
├── ping-targets/        # Контейнеры для тестирования
├── Dockerfile           # Docker-образ бота
├── docker-compose.yaml  # Среда для локального тестирования
├── go.mod, go.sum       # Зависимости Go
└── main.go              # Точка входа
```

## Лицензия

Проект распространяется по лицензии [MIT](./LICENSE).
Автор: BetterLuckNextLife, 2025.

Код можно свободно использовать, изменять и распространять с сохранением указания авторства. Ответственность за использование лежит на вас.
